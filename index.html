<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Medical Surgical Nursing ‚Äî Prometric Simulation Test</title>

  <meta property="og:title" content="Medical Surgical Nursing ‚Äî Prometric Simulation Test" />
  <meta property="og:description" content="Prepare yourself for the official Prometric exam. Click below to begin your simulation test." />
  <meta property="og:image" content="https://gyoutrain-lab.github.io/nursing-prometric-test/icon.png" />
  <meta name="theme-color" content="#1e3a8a" />

  <style>
    :root {
      --bg-light: linear-gradient(180deg, #eef2ff, #ffffff);
      --bg-dark: linear-gradient(180deg, #0f172a, #1e293b);
      --text-light: #1e3a8a;
      --text-dark: #f8fafc;
      --panel-light: #ffffff;
      --panel-dark: #1e293b;
      --option-light: #e0e7ff;
      --option-dark: #334155;
      --option-hover-light: #c7d2fe;
      --option-hover-dark: #475569;
      --correct-light: #93c5fd;
      --correct-dark: #2563eb;
      --incorrect-light: #fca5a5;
      --incorrect-dark: #dc2626;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
      text-align: center;
      padding: 30px 20px;
      transition: background 0.5s, color 0.5s;
    }

    body.dark {
      background: var(--bg-dark);
      color: var(--text-dark);
    }

    header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 10px;
      cursor: pointer;
    }

    header img {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      transition: 0.3s;
    }
    header img:hover { transform: scale(1.05); }

    header h1 { font-size: 1.5rem; margin: 0; text-align: left; }

    #themeToggle {
      position: fixed;
      top: 15px;
      right: 15px;
      background: #1e3a8a;
      color: white;
      border: none;
      border-radius: 50%;
      width: 38px;
      height: 38px;
      cursor: pointer;
      font-size: 1.1rem;
      transition: 0.3s;
    }
    #themeToggle:hover { background: #3749b7; }

    #welcome, .question-box {
      border-radius: 16px;
      padding: 30px;
      margin: 0 auto;
      max-width: 600px;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.1);
      animation: fadeIn 1s ease-in-out;
      background: var(--panel-light);
      color: var(--text-light);
      transition: background 0.4s, color 0.4s;
    }

    body.dark #welcome, body.dark .question-box {
      background: var(--panel-dark);
      color: var(--text-dark);
      box-shadow: 0 4px 14px rgba(255, 255, 255, 0.1);
    }

    .option {
      background: var(--option-light);
      border-radius: 8px;
      padding: 10px;
      margin: 8px 0;
      cursor: pointer;
      transition: 0.3s;
    }
    .option:hover { background: var(--option-hover-light); }

    body.dark .option {
      background: var(--option-dark);
      color: var(--text-dark);
    }
    body.dark .option:hover { background: var(--option-hover-dark); }

    .correct { background-color: var(--correct-light) !important; color: #fff; }
    .incorrect { background-color: var(--incorrect-light) !important; color: #fff; }
    body.dark .correct { background-color: var(--correct-dark) !important; }
    body.dark .incorrect { background-color: var(--incorrect-dark) !important; }

    .start-btn, .next-btn {
      display: inline-block;
      margin-top: 20px;
      padding: 10px 25px;
      border: none;
      background: #1e3a8a;
      color: white;
      border-radius: 30px;
      font-size: 1rem;
      cursor: pointer;
      transition: 0.3s;
    }
    .start-btn:hover, .next-btn:hover { background: #3749b7; }

    .stats { font-size: 0.95rem; margin-bottom: 10px; }

    .footer {
      margin-top: 40px;
      color: red;
      font-size: 0.9rem;
    }

    .pass { color: #22c55e; font-weight: bold; }
    .fail { color: #ef4444; font-weight: bold; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body>
  <button id="themeToggle" onclick="toggleTheme()">üåì</button>

  <header onclick="resetApp()">
    <img src="icon.png" alt="App Icon" />
    <h1>ü©∫ Medical Surgical Nursing ‚Äî<br>Prometric Simulation Test</h1>
  </header>

  <div id="welcome">
    <p>Welcome to the <b>Medical Surgical Nursing Prometric Simulation Test</b>.<br><br>
      You have <b>60 minutes</b> to complete <b>60 randomized questions</b>.<br><br>
      Click below to begin your simulation test.</p>
    <button class="start-btn" onclick="startTest()">‚ñ∂Ô∏è Start Test</button>
  </div>

  <div id="status" style="display:none;">‚è≥ Loading...</div>
  <div class="question-box" id="quiz" style="display:none;"></div>

  <div class="footer">Prepared by <b>Giyono Asfarrasyid</b>, ETK Yogyakarta</div>

  <!-- ‚úÖ Sounds -->
  <audio id="sound-correct" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_0ef9d2f6d0.mp3?filename=correct-2-46134.mp3"></audio>
  <audio id="sound-wrong" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_281b1f7f71.mp3?filename=wrong-answer-2-35945.mp3"></audio>
  <audio id="sound-warning" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_028b7b9a22.mp3?filename=alert-short-44038.mp3"></audio>

  <script>
    const scriptUrl = "https://script.google.com/macros/s/AKfycby4UKAAxodHiVYB3w4ps6_KCZewb6z2BqRwWn0viGJ1Uz6tSnIBwtHsOn7yVcLQMHSV/exec";
    const passingScore = 55; // pass threshold (%)
    let questions = [];
    let index = 0;
    let correctCount = 0;
    let incorrectCount = 0;
    let totalSeconds = 60 * 60;
    let timer;
    let warningPlayed = false;

    function toggleTheme() {
      document.body.classList.toggle("dark");
      const isDark = document.body.classList.contains("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
      document.getElementById("themeToggle").textContent = isDark ? "üåû" : "üåì";
    }

    (function initTheme() {
      const userPref = localStorage.getItem("theme");
      if (userPref === "dark" || (!userPref && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
        document.body.classList.add("dark");
        document.getElementById("themeToggle").textContent = "üåû";
      }
    })();

    function startTest() {
      document.getElementById("welcome").style.display = "none";
      document.getElementById("status").style.display = "block";
      loadQuestions();
    }

    async function loadQuestions() {
      try {
        const res = await fetch(scriptUrl);
        questions = await res.json();
        if (!Array.isArray(questions)) throw new Error("Invalid data");
        document.getElementById("status").style.display = "none";
        document.getElementById("quiz").style.display = "block";
        startTimer();
        showQuestion();
      } catch (e) {
        document.getElementById("status").innerHTML = "‚ö†Ô∏è Error loading questions!";
      }
    }

    function startTimer() {
      timer = setInterval(() => {
        totalSeconds--;
        if (totalSeconds === 60 && !warningPlayed) {
          document.getElementById("sound-warning").play();
          warningPlayed = true;
        }
        if (totalSeconds <= 0) {
          clearInterval(timer);
          endTest(true);
        }
        updateTimerDisplay();
      }, 1000);
    }

    function updateTimerDisplay() {
      const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, "0");
      const seconds = String(totalSeconds % 60).padStart(2, "0");
      const timerDisplay = document.getElementById("timerDisplay");
      if (timerDisplay) timerDisplay.innerText = `‚è± ${minutes}:${seconds}`;
    }

    function showQuestion() {
      if (index >= questions.length) return endTest(false);
      const q = questions[index];
      const quizDiv = document.getElementById("quiz");
      const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, "0");
      const seconds = String(totalSeconds % 60).padStart(2, "0");

      quizDiv.innerHTML = `
        <div class="stats" id="timerDisplay">‚è± ${minutes}:${seconds} | ‚úÖ ${correctCount} | ‚ùå ${incorrectCount}</div>
        <h3>Question ${index + 1} of ${questions.length}</h3>
        <p><b>Q${index + 1}.</b> ${q.question}</p>
        ${q.options.map((opt, i) => `
          <div class="option" onclick="checkAnswer(this, '${String.fromCharCode(65 + i)}', '${q.correctLetter}', '${q.rationale}')">${opt}</div>
        `).join("")}
      `;
    }

    function checkAnswer(element, selected, correct, rationale) {
      const soundCorrect = document.getElementById("sound-correct");
      const soundWrong = document.getElementById("sound-wrong");

      const options = document.querySelectorAll(".option");
      options.forEach(opt => opt.onclick = null);

      if (selected === correct) {
        element.classList.add("correct");
        correctCount++;
        soundCorrect.play();
      } else {
        element.classList.add("incorrect");
        incorrectCount++;
        soundWrong.play();
      }

      const rationaleDiv = document.createElement("div");
      rationaleDiv.style.marginTop = "10px";
      rationaleDiv.innerHTML = `üí° <b>Rationale:</b> ${rationale}`;
      document.getElementById("quiz").appendChild(rationaleDiv);

      const nextButton = document.createElement("button");
      nextButton.innerText = "Next";
      nextButton.className = "next-btn";
      nextButton.onclick = () => { index++; showQuestion(); };
      document.getElementById("quiz").appendChild(nextButton);
    }

    function endTest(timeUp) {
      clearInterval(timer);
      const percent = ((correctCount / questions.length) * 100).toFixed(1);
      const status = percent >= passingScore ? "PASS" : "FAIL";
      const statusClass = percent >= passingScore ? "pass" : "fail";

      document.getElementById("quiz").innerHTML = `
        <h3>üèÅ Test Complete ${timeUp ? "(Time Up)" : ""}</h3>
        <p>‚úÖ Correct: ${correctCount}<br>‚ùå Incorrect: ${incorrectCount}<br>üìä Score: ${percent}%</p>
        <p class="${statusClass}">Result: ${status}</p>
        <button class="start-btn" onclick="resetApp()">üîÑ Restart Test</button>
      `;
    }

    function resetApp() {
      clearInterval(timer);
      index = 0;
      correctCount = 0;
      incorrectCount = 0;
      totalSeconds = 60 * 60;
      warningPlayed = false;
      document.getElementById("quiz").style.display = "none";
      document.getElementById("status").style.display = "none";
      document.getElementById("welcome").style.display = "block";
    }
  </script>
</body>
</html>
